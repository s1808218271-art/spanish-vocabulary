<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Vocabulary Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-btn.active { border-bottom: 2px solid #4f46e5; color: #4f46e5; font-weight: 600; }
        .tab-btn { color: #64748b; padding-bottom: 8px; transition: all 0.2s; }
        .tab-btn:hover { color: #4f46e5; }
        input:focus { outline: none; border-color: #6366f1; ring: 2px solid #e0e7ff; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- 1. è®¾ç½®ä¸å½•å…¥é¡µ -->
    <div id="setup-view" class="w-full max-w-3xl bg-white rounded-xl shadow-xl p-8 fade-in">
        <h1 class="text-3xl font-bold text-gray-800 mb-2 flex items-center gap-2">
            <span>ğŸ‡ªğŸ‡¸</span> æç®€èƒŒå•è¯
        </h1>
        
        <p class="text-gray-500 mb-6">çº¯å‡€æ¨¡å¼ï¼šä¸“æ³¨äºå•è¯æ‹¼å†™ä¸å«ä¹‰ã€‚</p>
        
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                è¾“å…¥åˆ—è¡¨ (æ ¼å¼ï¼šå•è¯, ä¸­æ–‡é‡Šä¹‰)
            </label>
            <textarea id="word-input" 
                class="w-full h-64 p-4 border border-gray-300 rounded-lg font-mono text-base bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm" 
                placeholder="Gato, çŒ«&#10;La mano, æ‰‹&#10;Comer, åƒ"></textarea>
            <div class="flex justify-between mt-2 text-xs text-gray-400">
                <span>æç¤ºï¼šåŠ¨è¯ä¼šè‡ªåŠ¨ç”Ÿæˆå˜ä½è¡¨ä¾›å¤ä¹ </span>
                <span>æ¯è¡Œä¸€ä¸ªå•è¯</span>
            </div>
        </div>

        <button onclick="processWords()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-6 rounded-lg transition duration-200 shadow-md flex justify-center items-center gap-2">
            <span>å¼€å§‹è®°å¿†</span>
        </button>
    </div>

    <!-- 2. å­¦ä¹ /ç­”é¢˜é¡µ -->
    <div id="game-view" class="w-full max-w-2xl hidden flex flex-col gap-4">
        
        <!-- é¡¶éƒ¨æ  -->
        <div class="flex justify-between items-center text-sm font-medium text-gray-500 px-1">
            <button onclick="resetApp()" class="hover:text-indigo-600 flex items-center gap-1">â† è¿”å›ç¼–è¾‘</button>
            <span id="progress-text" class="bg-white px-3 py-1 rounded-full shadow-sm">1 / 10</span>
        </div>

        <div class="bg-white rounded-2xl shadow-xl overflow-hidden fade-in border border-gray-100">
            
            <!-- å•è¯å¡ç‰‡å¤´éƒ¨ -->
            <div class="bg-gradient-to-br from-indigo-900 to-blue-900 text-white p-12 text-center relative">
                <div class="flex flex-col items-center justify-center gap-3">
                    <h2 id="current-word" class="text-6xl font-bold tracking-tight mb-1 capitalize drop-shadow-md">Word</h2>
                </div>
            </div>

            <div class="p-6 sm:p-8">
                
                <!-- ç­”é¢˜åŒºåŸŸ -->
                <div id="quiz-area" class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="user-answer">è¯·è¾“å…¥ä¸­æ–‡å«ä¹‰ï¼š</label>
                    <div class="flex gap-2">
                        <input id="user-answer" type="text" class="flex-1 appearance-none border border-gray-300 rounded-lg py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:border-indigo-500 transition shadow-sm text-lg" placeholder="ä¾‹å¦‚ï¼šçŒ«" autocomplete="off">
                        <button id="check-btn" onclick="checkAnswer()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition shadow-md">æ£€æŸ¥</button>
                    </div>
                    <div id="feedback-msg" class="mt-4 hidden rounded-lg p-4 text-center font-bold text-lg"></div>
                </div>

                <!-- è¯­æ³•è¯¦æƒ…é¢æ¿ (ç­”é¢˜åæ˜¾ç¤º) -->
                <div id="grammar-panel" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="border-t border-gray-100 my-6"></div>
                    
                    <!-- 1. åŠ¨è¯å˜ä½åŒºåŸŸ (ä»…å½“æ˜¯åŠ¨è¯æ—¶æ˜¾ç¤ºï¼Œä½œä¸ºçŸ¥è¯†è¡¥å……) -->
                    <div id="verb-section" class="hidden">
                        <h3 class="text-gray-800 font-bold mb-4 flex items-center gap-2">
                            <span class="w-1 h-6 bg-indigo-500 rounded-full"></span>
                            åŠ¨è¯å˜ä½è¡¨
                        </h3>
                        <!-- Tabs -->
                        <div class="flex border-b border-gray-200 mb-4 text-sm overflow-x-auto gap-4 whitespace-nowrap px-1 no-scrollbar">
                            <button onclick="switchTab('presente')" class="tab-btn active" id="tab-presente">ç°åœ¨æ—¶</button>
                            <button onclick="switchTab('pasado')" class="tab-btn" id="tab-pasado">è¿‡å»æ—¶</button>
                            <button onclick="switchTab('perfecto')" class="tab-btn" id="tab-perfecto">è¿‡å»å®Œæˆ</button>
                            <button onclick="switchTab('futuro')" class="tab-btn" id="tab-futuro">å°†æ¥æ—¶</button>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-100 text-sm">
                            <div id="content-presente" class="conjugation-content grid grid-cols-2 gap-y-2 gap-x-4"></div>
                            <div id="content-pasado" class="conjugation-content grid grid-cols-2 gap-y-2 gap-x-4 hidden"></div>
                            <div id="content-perfecto" class="conjugation-content grid grid-cols-2 gap-y-2 gap-x-4 hidden"></div>
                            <div id="content-futuro" class="conjugation-content grid grid-cols-2 gap-y-2 gap-x-4 hidden"></div>
                        </div>
                    </div>

                    <!-- ä¸‹ä¸€é¢˜æŒ‰é’® -->
                    <button id="next-btn" onclick="nextCard()" class="w-full mt-6 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition hover:-translate-y-0.5 flex justify-center items-center gap-2">
                        <span>ä¸‹ä¸€ä¸ªå•è¯</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. ç»“æŸé¡µ -->
    <div id="end-view" class="w-full max-w-md bg-white rounded-xl shadow-lg p-8 text-center hidden fade-in">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">å¤ä¹ å®Œæˆï¼ğŸ‰</h2>
        <button onclick="resetApp()" class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition shadow-md">
            è¾“å…¥æ–°å•è¯
        </button>
    </div>

    <script>
        // --- æ ¸å¿ƒé€»è¾‘ ---

        let vocabulary = [];
        let currentIndex = 0;
        let isAnswered = false;

        function processWords() {
            const rawInput = document.getElementById('word-input').value;
            const lines = rawInput.split('\n').filter(line => line.trim() !== '');

            if (lines.length === 0) {
                alert("è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªå•è¯ï¼");
                return;
            }

            vocabulary = lines.map(line => {
                let word, meaning;
                const commaSplit = line.split(/[,ï¼Œ]/);
                
                if (commaSplit.length > 1) {
                    word = commaSplit[0].trim();
                    meaning = commaSplit.slice(1).join(",").trim();
                } else {
                    const parts = line.trim().split(/\s+/);
                    const first = parts[0].toLowerCase();
                    // å…¼å®¹å¸¦å† è¯è¾“å…¥çš„æƒ…å†µï¼Œåªä¸ºæå–å•è¯ä¸»ä½“
                    if (['el', 'la', 'un', 'una', 'los', 'las'].includes(first) && parts.length >= 2) {
                        word = parts[0] + " " + parts[1];
                        meaning = parts.slice(2).join(" ");
                    } else {
                        word = parts[0];
                        meaning = parts.slice(1).join(" ");
                    }
                }
                if(!meaning) meaning = "???";

                let type = guessType(word);
                let wordBody = getWordBody(word);
                
                let data = {
                    original: word, 
                    wordBody: wordBody,
                    meaning: meaning,
                    type: type,
                };

                if (type === 'verb') {
                    data.conjugation = generateConjugations(data.wordBody);
                } 
                
                return data;
            });

            vocabulary.sort(() => Math.random() - 0.5);
            startSession();
        }

        function getWordBody(text) {
            return text.replace(/^(el|la|los|las|un|una)\s+/i, '');
        }

        // ä¾ç„¶ä¿ç•™åˆ¤æ–­é€»è¾‘ï¼Œä¸ºäº†ç”ŸæˆåŠ¨è¯å˜ä½è¡¨ï¼ˆè¿™å±äºçŸ¥è¯†ç‚¹ï¼Œä¸æ˜¯æ ‡ç­¾ï¼‰
        function guessType(word) {
            let body = getWordBody(word).toLowerCase();
            if (body.endsWith('ar') || body.endsWith('er') || body.endsWith('ir')) {
                if (body.length >= 2) return 'verb';
            }
            return 'noun';
        }

        function generateConjugations(wordBody) {
            let w = wordBody.toLowerCase();
            const ending = w.slice(-2);
            const stem = w.slice(0, -2);
            let part = (ending === 'ar') ? stem + 'ado' : stem + 'ido';
            const endings = {
                ar: { pres: ['o','as','a','amos','Ã¡is','an'], pas: ['Ã©','aste','Ã³','amos','asteis','aron'] },
                er: { pres: ['o','es','e','emos','Ã©is','en'], pas: ['Ã­','iste','iÃ³','imos','isteis','ieron'] },
                ir: { pres: ['o','es','e','imos','Ã­s','en'], pas: ['Ã­','iste','iÃ³','imos','isteis','ieron'] }
            };
            let e = endings[ending] || endings['ar'];
            return {
                presente: makeGrid(stem, e.pres),
                pasado: makeGrid(stem, e.pas),
                perfecto: makePerf(part),
                futuro: makeFut(w)
            };
        }

        function makeGrid(stem, s) { return { yo: stem+s[0], tu: stem+s[1], el: stem+s[2], nos: stem+s[3], vos: stem+s[4], ellos: stem+s[5] }; }
        function makePerf(part) { return { yo: 'habÃ­a '+part, tu: 'habÃ­as '+part, el: 'habÃ­a '+part, nos: 'habÃ­amos '+part, vos: 'habÃ­ais '+part, ellos: 'habÃ­an '+part }; }
        function makeFut(inf) { return { yo: inf+'Ã©', tu: inf+'Ã¡s', el: inf+'Ã¡', nos: inf+'emos', vos: inf+'Ã©is', ellos: inf+'Ã¡n' }; }

        // --- 3. UI äº¤äº’ ---

        function startSession() {
            document.getElementById('setup-view').classList.add('hidden');
            document.getElementById('end-view').classList.add('hidden');
            document.getElementById('game-view').classList.remove('hidden');
            currentIndex = 0;
            renderCard();
        }

        function renderCard() {
            isAnswered = false;
            const data = vocabulary[currentIndex];
            // æ˜¾ç¤ºå•è¯ä¸»ä½“
            document.getElementById('current-word').innerText = data.wordBody;
            // ç§»é™¤äº† Type æ˜¾ç¤º
            document.getElementById('progress-text').innerText = `${currentIndex + 1} / ${vocabulary.length}`;
            
            const input = document.getElementById('user-answer');
            input.value = ''; input.disabled = false;
            input.className = "flex-1 appearance-none border border-gray-300 rounded-lg py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:border-indigo-500 transition shadow-sm text-lg";
            input.focus();

            document.getElementById('check-btn').style.display = 'block';
            document.getElementById('feedback-msg').classList.add('hidden');
            document.getElementById('grammar-panel').classList.add('hidden');
            // ç§»é™¤äº†è‡ªåŠ¨æ’­æ”¾å‘éŸ³
        }

        function checkAnswer() {
            if (isAnswered) return;
            const input = document.getElementById('user-answer');
            const feedback = document.getElementById('feedback-msg');
            const data = vocabulary[currentIndex];
            
            if (!input.value.trim()) return;

            isAnswered = true;
            input.disabled = true;
            document.getElementById('check-btn').style.display = 'none';
            feedback.classList.remove('hidden');

            const isCorrect = input.value.trim() === data.meaning || data.meaning.includes(input.value.trim());

            if (isCorrect) {
                feedback.innerHTML = `<span class="text-green-600">âœ… æ­£ç¡®ï¼</span> (${data.meaning})`;
                feedback.className = "mt-4 rounded-lg p-4 text-center font-bold text-lg bg-green-50 border border-green-200";
                input.classList.add('border-green-500', 'bg-green-50');
            } else {
                feedback.innerHTML = `<span class="text-red-600">âŒ ç­”æ¡ˆï¼š${data.meaning}</span>`;
                feedback.className = "mt-4 rounded-lg p-4 text-center font-bold text-lg bg-red-50 border border-red-200";
                input.classList.add('border-red-500', 'bg-red-50');
            }
            showGrammar(data);
        }

        function showGrammar(data) {
            document.getElementById('grammar-panel').classList.remove('hidden');
            document.getElementById('verb-section').classList.add('hidden');
            
            if (data.type === 'verb') {
                document.getElementById('verb-section').classList.remove('hidden');
                renderConjugation(data.conjugation);
                switchTab('presente');
            }
        }

        function renderConjugation(c) {
            fillGrid('content-presente', c.presente);
            fillGrid('content-pasado', c.pasado);
            fillGrid('content-perfecto', c.perfecto);
            fillGrid('content-futuro', c.futuro);
        }
        function fillGrid(id, d) {
            document.getElementById(id).innerHTML = `
                <div><span class="text-gray-400 text-xs">Yo</span> <span class="font-bold text-gray-800">${d.yo}</span></div>
                <div><span class="text-gray-400 text-xs">Nos</span> <span class="font-bold text-gray-800">${d.nos}</span></div>
                <div><span class="text-gray-400 text-xs">TÃº</span> <span class="font-bold text-gray-800">${d.tu}</span></div>
                <div><span class="text-gray-400 text-xs">Vos</span> <span class="font-bold text-gray-800">${d.vos}</span></div>
                <div><span class="text-gray-400 text-xs">Ã‰l</span> <span class="font-bold text-gray-800">${d.el}</span></div>
                <div><span class="text-gray-400 text-xs">Ellos</span> <span class="font-bold text-gray-800">${d.ellos}</span></div>
            `;
        }

        window.switchTab = function(t) {
            document.querySelectorAll('.conjugation-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`content-${t}`).classList.remove('hidden');
            document.getElementById(`tab-${t}`).classList.add('active');
        }

        function nextCard() {
            currentIndex++;
            if (currentIndex >= vocabulary.length) {
                document.getElementById('game-view').classList.add('hidden');
                document.getElementById('end-view').classList.remove('hidden');
            } else {
                renderCard();
            }
        }
        
        function resetApp() {
            document.getElementById('end-view').classList.add('hidden');
            document.getElementById('game-view').classList.add('hidden');
            document.getElementById('setup-view').classList.remove('hidden');
        }
        
        document.getElementById('user-answer').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') { if(!isAnswered) checkAnswer(); else nextCard(); }
        });
    </script>
</body>
</html>
