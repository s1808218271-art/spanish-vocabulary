<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Vocabulary Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-btn.active { border-bottom: 2px solid #4f46e5; color: #4f46e5; font-weight: 600; }
        .tab-btn { color: #64748b; padding-bottom: 8px; transition: all 0.2s; }
        .tab-btn:hover { color: #4f46e5; }
        input:focus { outline: none; border-color: #6366f1; ring: 2px solid #e0e7ff; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- 1. è®¾ç½®ä¸å½•å…¥é¡µ -->
    <div id="setup-view" class="w-full max-w-3xl bg-white rounded-xl shadow-xl p-8 fade-in">
        <h1 class="text-3xl font-bold text-gray-800 mb-2 flex items-center gap-2">
            <span>ğŸ‡ªğŸ‡¸</span> æç®€èƒŒå•è¯
        </h1>
        
        <p class="text-gray-500 mb-6">çº¯å‡€æ¨¡å¼ï¼šä¸“æ³¨äºå•è¯æ‹¼å†™ä¸å«ä¹‰ã€‚</p>
        
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                è¾“å…¥åˆ—è¡¨ (æ ¼å¼ï¼šè¥¿è¯­å†…å®¹ ä¸­æ–‡é‡Šä¹‰)
            </label>
            <textarea id="word-input" 
                class="w-full h-64 p-4 border border-gray-300 rounded-lg font-mono text-base bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm" 
                placeholder="Gato çŒ«&#10;Tomar el pelo å˜²å¼„/å¼€ç©ç¬‘ (è‡ªåŠ¨è¯†åˆ«è¯ç»„)&#10;Darse cuenta de æ„è¯†åˆ°&#10;La casa de papel çº¸é’å±‹"></textarea>
            <div class="flex justify-between mt-2 text-xs text-gray-400">
                <span>âš¡ï¸ æ™ºèƒ½è¯†åˆ«ï¼šæ”¯æŒå¤šè¯çŸ­è¯­ï¼Œè‡ªåŠ¨é€šè¿‡ä¸­æ–‡åŒºåˆ†</span>
                <span>æ¯è¡Œä¸€æ¡</span>
            </div>
        </div>

        <button onclick="processWords()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-6 rounded-lg transition duration-200 shadow-md flex justify-center items-center gap-2">
            <span>å¼€å§‹è®°å¿†</span>
        </button>
    </div>

    <!-- 2. å­¦ä¹ /ç­”é¢˜é¡µ -->
    <div id="game-view" class="w-full max-w-2xl hidden flex flex-col gap-4">
        
        <!-- é¡¶éƒ¨æ  -->
        <div class="flex justify-between items-center text-sm font-medium text-gray-500 px-1">
            <button onclick="resetApp()" class="hover:text-indigo-600 flex items-center gap-1">â† è¿”å›ç¼–è¾‘</button>
            <span id="progress-text" class="bg-white px-3 py-1 rounded-full shadow-sm">1 / 10</span>
        </div>

        <div class="bg-white rounded-2xl shadow-xl overflow-hidden fade-in border border-gray-100">
            
            <!-- å•è¯å¡ç‰‡å¤´éƒ¨ -->
            <div class="bg-gradient-to-br from-indigo-900 to-blue-900 text-white p-12 text-center relative">
                <div class="flex flex-col items-center justify-center gap-3">
                    <!-- ä½¿ç”¨ break-words é˜²æ­¢é•¿çŸ­è¯­æº¢å‡ºï¼Œå¹¶è°ƒæ•´å­—ä½“å¤§å°è‡ªé€‚åº” -->
                    <h2 id="current-word" class="text-4xl md:text-5xl font-bold tracking-tight mb-1 capitalize drop-shadow-md break-words max-w-full">Word</h2>
                </div>
            </div>

            <div class="p-6 sm:p-8">
                
                <!-- ç­”é¢˜åŒºåŸŸ -->
                <div id="quiz-area" class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="user-answer">è¯·è¾“å…¥ä¸­æ–‡å«ä¹‰ï¼š</label>
                    <div class="flex gap-2">
                        <input id="user-answer" type="text" class="flex-1 appearance-none border border-gray-300 rounded-lg py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:border-indigo-500 transition shadow-sm text-lg" placeholder="ä¾‹å¦‚ï¼šçŒ«" autocomplete="off">
                        <button id="check-btn" onclick="checkAnswer()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition shadow-md">æ£€æŸ¥</button>
                    </div>
                    <div id="feedback-msg" class="mt-4 hidden rounded-lg p-4 text-center font-bold text-lg"></div>
                </div>

                <!-- è¯­æ³•è¯¦æƒ…é¢æ¿ (ç­”é¢˜åæ˜¾ç¤º) -->
                <div id="grammar-panel" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="border-t border-gray-100 my-6"></div>
                    
                    <!-- 1. åŠ¨è¯å˜ä½åŒºåŸŸ (ä»…å½“æ˜¯åŠ¨è¯æ—¶æ˜¾ç¤ºï¼Œä½œä¸ºçŸ¥è¯†è¡¥å……) -->
                    <div id="verb-section" class="hidden">
                        <h3 class="text-gray-800 font-bold mb-4 flex items-center gap-2">
                            <span class="w-1 h-6 bg-indigo-500 rounded-full"></span>
                            åŠ¨è¯å˜ä½è¡¨
                        </h3>
                        <!-- Tabs -->
                        <div class="flex border-b border-gray-200 mb-4 text-sm overflow-x-auto gap-4 whitespace-nowrap px-1 no-scrollbar">
                            <button onclick="switchTab('presente')" class="tab-btn active" id="tab-presente">ç°åœ¨æ—¶</button>
                            <button onclick="switchTab('pasado')" class="tab-btn" id="tab-pasado">è¿‡å»æ—¶</button>
                            <button onclick="switchTab('perfecto')" class="tab-btn" id="tab-perfecto">è¿‡å»å®Œæˆ</button>
                            <button onclick="switchTab('futuro')" class="tab-btn" id="tab-futuro">å°†æ¥æ—¶</button>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-100 text-sm">
                            <div id="content-presente" class="conjugation-content grid grid-cols-2 gap-y-2 gap-x-4"></div>
                            <div id="content-pasado" class="conjugation-content grid grid-cols-2 gap-y-2 gap-x-4 hidden"></div>
                            <div id="content-perfecto" class="conjugation-content grid grid-cols-2 gap-y-2 gap-x-4 hidden"></div>
                            <div id="content-futuro" class="conjugation-content grid grid-cols-2 gap-y-2 gap-x-4 hidden"></div>
                        </div>
                    </div>

                    <!-- ä¸‹ä¸€é¢˜æŒ‰é’® -->
                    <button id="next-btn" onclick="nextCard()" class="w-full mt-6 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition hover:-translate-y-0.5 flex justify-center items-center gap-2">
                        <span>ä¸‹ä¸€ä¸ªå•è¯</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. ç»“æŸé¡µ -->
    <div id="end-view" class="w-full max-w-md bg-white rounded-xl shadow-lg p-8 text-center hidden fade-in">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">å¤ä¹ å®Œæˆï¼ğŸ‰</h2>
        <button onclick="resetApp()" class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition shadow-md">
            è¾“å…¥æ–°å•è¯
        </button>
    </div>

    <script>
        // --- æ ¸å¿ƒé€»è¾‘ ---

        let vocabulary = [];
        let currentIndex = 0;
        let isAnswered = false;

        function processWords() {
            const rawInput = document.getElementById('word-input').value;
            const lines = rawInput.split('\n').filter(line => line.trim() !== '');

            if (lines.length === 0) {
                alert("è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªå•è¯ï¼");
                return;
            }

            vocabulary = lines.map(line => {
                let word, meaning;
                line = line.trim();

                // 1. ä¼˜å…ˆå°è¯•é€—å·åˆ†éš” (æ˜¾å¼åˆ†éš”æœ€å®‰å…¨)
                const commaSplit = line.split(/[,ï¼Œ]/);
                
                if (commaSplit.length > 1) {
                    word = commaSplit[0].trim();
                    meaning = commaSplit.slice(1).join(",").trim();
                } else {
                    // 2. æ™ºèƒ½åˆ†éš”ï¼šå¯»æ‰¾ç¬¬ä¸€ä¸ªä¸­æ–‡å­—ç¬¦çš„ä½ç½®
                    // åªè¦æœ‰ä¸­æ–‡ï¼Œæˆ‘ä»¬å°±å‡è®¾ä¸­æ–‡å¼€å§‹çš„åœ°æ–¹å°±æ˜¯é‡Šä¹‰çš„å¼€å§‹
                    const chineseIndex = line.search(/[\u4e00-\u9fa5]/);
                    
                    if (chineseIndex !== -1) {
                        word = line.substring(0, chineseIndex).trim();
                        meaning = line.substring(chineseIndex).trim();
                    } else {
                        // 3. å¦‚æœæ²¡æœ‰é€—å·ä¹Ÿæ²¡æœ‰ä¸­æ–‡ (çº¯è¥¿è¯­ç¯å¢ƒæˆ–æ ¼å¼ä¸æ ‡å‡†)
                        // å°è¯•ä½¿ç”¨ç©ºæ ¼åˆ†å‰²çš„å…œåº•ç­–ç•¥
                        const parts = line.split(/\s+/);
                        const first = parts[0].toLowerCase();
                        
                        // å¦‚æœæ˜¯å† è¯å¼€å¤´ï¼Œå€¾å‘äºè®¤ä¸ºå‰ä¸¤ä¸ªè¯æ˜¯æ•´ä½“ (å¦‚ El Gato)
                        if (['el', 'la', 'un', 'una', 'los', 'las'].includes(first) && parts.length >= 2) {
                            if (parts.length === 2) {
                                word = parts.join(" "); // ä¾‹å¦‚ "El Gato"ï¼Œæ²¡æœ‰æ„æ€
                                meaning = "???";
                            } else {
                                word = parts[0] + " " + parts[1];
                                meaning = parts.slice(2).join(" ");
                            }
                        } else {
                            // é»˜è®¤å–ç¬¬ä¸€ä¸ªè¯ï¼Œåé¢å…¨æ˜¯æ„æ€ (æ—§é€»è¾‘)
                            if (parts.length > 1) {
                                word = parts[0];
                                meaning = parts.slice(1).join(" ");
                            } else {
                                word = line;
                                meaning = "???";
                            }
                        }
                    }
                }
                
                if(!meaning) meaning = "???";

                let type = guessType(word);
                let wordBody = getWordBody(word);
                
                let data = {
                    original: word, 
                    wordBody: wordBody,
                    meaning: meaning,
                    type: type,
                };

                if (type === 'verb') {
                    data.conjugation = generateConjugations(data.wordBody);
                } 
                
                return data;
            });

            vocabulary.sort(() => Math.random() - 0.5);
            startSession();
        }

        function getWordBody(text) {
            // ç§»é™¤å¼€å¤´çš„å† è¯ï¼Œä¸ºäº†å˜ä½å’Œåˆ†ææ›´å‡†ç¡®
            return text.replace(/^(el|la|los|las|un|una)\s+/i, '');
        }

        function guessType(word) {
            let body = getWordBody(word).toLowerCase();
            // ç®€å•åˆ¤æ–­ï¼šå¦‚æœä»¥ar/er/irç»“å°¾ï¼Œè®¤ä¸ºæ˜¯åŠ¨è¯
            // æ³¨æ„ï¼šå¯¹äºçŸ­è¯­ "Tomar el pelo"ï¼ŒwordBody æ˜¯ "Tomar el pelo"ï¼Œç»“å°¾æ˜¯ oï¼Œå¯èƒ½åˆ¤é”™
            // æ”¹è¿›ï¼šå¦‚æœæ˜¯å¤šè¯çŸ­è¯­ï¼Œæ£€æŸ¥ç¬¬ä¸€ä¸ªè¯æ˜¯å¦æ˜¯åŠ¨è¯
            
            const parts = body.split(/\s+/);
            const firstWord = parts[0];
            
            if (firstWord.endsWith('ar') || firstWord.endsWith('er') || firstWord.endsWith('ir')) {
                 if (firstWord.length >= 2) return 'verb';
            }
            // å…œåº•ï¼šæ£€æŸ¥æ•´ä¸ªä¸²ç»“å°¾ (é’ˆå¯¹å•ä¸ªè¯)
            if (body.endsWith('ar') || body.endsWith('er') || body.endsWith('ir')) {
                if (body.length >= 2) return 'verb';
            }

            return 'noun';
        }

        function generateConjugations(wordBody) {
            // å¯¹äºçŸ­è¯­ï¼Œæˆ‘ä»¬åªå¯¹ç¬¬ä¸€ä¸ªè¯è¿›è¡Œå˜ä½æ¨æµ‹
            let w = wordBody.toLowerCase();
            const parts = w.split(/\s+/);
            const verb = parts[0]; // å–ç¬¬ä¸€ä¸ªè¯å˜ä½ï¼Œæ¯”å¦‚ "tomar"
            const rest = parts.length > 1 ? " " + parts.slice(1).join(" ") : ""; // ä¿ç•™å‰©ä½™éƒ¨åˆ† " el pelo"

            const ending = verb.slice(-2);
            const stem = verb.slice(0, -2);
            
            // ç®€å•çš„è§„åˆ™å˜ä½é€»è¾‘
            let part = (ending === 'ar') ? stem + 'ado' : stem + 'ido';
            const endings = {
                ar: { pres: ['o','as','a','amos','Ã¡is','an'], pas: ['Ã©','aste','Ã³','amos','asteis','aron'] },
                er: { pres: ['o','es','e','emos','Ã©is','en'], pas: ['Ã­','iste','iÃ³','imos','isteis','ieron'] },
                ir: { pres: ['o','es','e','imos','Ã­s','en'], pas: ['Ã­','iste','iÃ³','imos','isteis','ieron'] }
            };
            
            // å¦‚æœä¸æ˜¯è§„åˆ™ç»“å°¾ï¼Œé»˜è®¤æŒ‰ ar å¤„ç†é˜²æ­¢æŠ¥é”™ï¼Œæˆ–è€…æç¤ºæ— æ³•å˜ä½
            let e = endings[ending] || endings['ar']; 
            
            // ç”Ÿæˆå˜ä½æ—¶ï¼Œè¦æŠŠå‰©ä½™çš„çŸ­è¯­åŠ ä¸Šå»
            // ä¾‹å¦‚: yo tomo el pelo
            return {
                presente: makeGrid(stem, e.pres, rest),
                pasado: makeGrid(stem, e.pas, rest),
                perfecto: makePerf(part, rest),
                futuro: makeFut(verb, rest)
            };
        }

        function makeGrid(stem, s, rest) { 
            return { 
                yo: stem+s[0]+rest, 
                tu: stem+s[1]+rest, 
                el: stem+s[2]+rest, 
                nos: stem+s[3]+rest, 
                vos: stem+s[4]+rest, 
                ellos: stem+s[5]+rest 
            }; 
        }
        function makePerf(part, rest) { 
            return { 
                yo: 'habÃ­a '+part+rest, 
                tu: 'habÃ­as '+part+rest, 
                el: 'habÃ­a '+part+rest, 
                nos: 'habÃ­amos '+part+rest, 
                vos: 'habÃ­ais '+part+rest, 
                ellos: 'habÃ­an '+part+rest 
            }; 
        }
        function makeFut(inf, rest) { 
            return { 
                yo: inf+'Ã©'+rest, 
                tu: inf+'Ã¡s'+rest, 
                el: inf+'Ã¡'+rest, 
                nos: inf+'emos'+rest, 
                vos: inf+'Ã©is'+rest, 
                ellos: inf+'Ã¡n'+rest 
            }; 
        }

        // --- 3. UI äº¤äº’ ---

        function startSession() {
            document.getElementById('setup-view').classList.add('hidden');
            document.getElementById('end-view').classList.add('hidden');
            document.getElementById('game-view').classList.remove('hidden');
            currentIndex = 0;
            renderCard();
        }

        function renderCard() {
            isAnswered = false;
            const data = vocabulary[currentIndex];
            // æ˜¾ç¤ºå®Œæ•´å•è¯æˆ–çŸ­è¯­
            document.getElementById('current-word').innerText = data.original; // ä½¿ç”¨ original æ˜¾ç¤ºå®Œæ•´è¾“å…¥
            
            document.getElementById('progress-text').innerText = `${currentIndex + 1} / ${vocabulary.length}`;
            
            const input = document.getElementById('user-answer');
            input.value = ''; input.disabled = false;
            input.className = "flex-1 appearance-none border border-gray-300 rounded-lg py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:border-indigo-500 transition shadow-sm text-lg";
            input.focus();

            document.getElementById('check-btn').style.display = 'block';
            document.getElementById('feedback-msg').classList.add('hidden');
            document.getElementById('grammar-panel').classList.add('hidden');
        }

        function checkAnswer() {
            if (isAnswered) return;
            const input = document.getElementById('user-answer');
            const feedback = document.getElementById('feedback-msg');
            const data = vocabulary[currentIndex];
            
            if (!input.value.trim()) return;

            isAnswered = true;
            input.disabled = true;
            document.getElementById('check-btn').style.display = 'none';
            feedback.classList.remove('hidden');

            const isCorrect = input.value.trim() === data.meaning || data.meaning.includes(input.value.trim());

            if (isCorrect) {
                feedback.innerHTML = `<span class="text-green-600">âœ… æ­£ç¡®ï¼</span> (${data.meaning})`;
                feedback.className = "mt-4 rounded-lg p-4 text-center font-bold text-lg bg-green-50 border border-green-200";
                input.classList.add('border-green-500', 'bg-green-50');
            } else {
                feedback.innerHTML = `<span class="text-red-600">âŒ ç­”æ¡ˆï¼š${data.meaning}</span>`;
                feedback.className = "mt-4 rounded-lg p-4 text-center font-bold text-lg bg-red-50 border border-red-200";
                input.classList.add('border-red-500', 'bg-red-50');
            }
            showGrammar(data);
        }

        function showGrammar(data) {
            document.getElementById('grammar-panel').classList.remove('hidden');
            document.getElementById('verb-section').classList.add('hidden');
            
            if (data.type === 'verb') {
                document.getElementById('verb-section').classList.remove('hidden');
                renderConjugation(data.conjugation);
                switchTab('presente');
            }
        }

        function renderConjugation(c) {
            fillGrid('content-presente', c.presente);
            fillGrid('content-pasado', c.pasado);
            fillGrid('content-perfecto', c.perfecto);
            fillGrid('content-futuro', c.futuro);
        }
        function fillGrid(id, d) {
            document.getElementById(id).innerHTML = `
                <div><span class="text-gray-400 text-xs">Yo</span> <span class="font-bold text-gray-800">${d.yo}</span></div>
                <div><span class="text-gray-400 text-xs">Nos</span> <span class="font-bold text-gray-800">${d.nos}</span></div>
                <div><span class="text-gray-400 text-xs">TÃº</span> <span class="font-bold text-gray-800">${d.tu}</span></div>
                <div><span class="text-gray-400 text-xs">Vos</span> <span class="font-bold text-gray-800">${d.vos}</span></div>
                <div><span class="text-gray-400 text-xs">Ã‰l</span> <span class="font-bold text-gray-800">${d.el}</span></div>
                <div><span class="text-gray-400 text-xs">Ellos</span> <span class="font-bold text-gray-800">${d.ellos}</span></div>
            `;
        }

        window.switchTab = function(t) {
            document.querySelectorAll('.conjugation-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`content-${t}`).classList.remove('hidden');
            document.getElementById(`tab-${t}`).classList.add('active');
        }

        function nextCard() {
            currentIndex++;
            if (currentIndex >= vocabulary.length) {
                document.getElementById('game-view').classList.add('hidden');
                document.getElementById('end-view').classList.remove('hidden');
            } else {
                renderCard();
            }
        }
        
        function resetApp() {
            document.getElementById('end-view').classList.add('hidden');
            document.getElementById('game-view').classList.add('hidden');
            document.getElementById('setup-view').classList.remove('hidden');
        }
        
        document.getElementById('user-answer').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') { if(!isAnswered) checkAnswer(); else nextCard(); }
        });
    </script>
</body>
</html>
